<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lora 训练任务管理器</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app">
        <header>
            <h1>Lora 训练任务管理器</h1>
            <p class="subtitle">实时监控训练任务状态</p>
        </header>

        <section class="stats">
            <h2>任务统计</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>总任务数</h3>
                    <p>{{ stats.total }}</p>
                </div>
                <div class="stat-item">
                    <h3>下载中</h3>
                    <p>{{ stats.downloading }}</p>
                </div>
                <div class="stat-item">
                    <h3>等待训练</h3>
                    <p>{{ stats.pending }}</p>
                </div>
                <div class="stat-item">
                    <h3>训练中</h3>
                    <p>{{ stats.training }}</p>
                </div>
                <div class="stat-item">
                    <h3>等待上传</h3>
                    <p>{{ stats.pending_upload }}</p>
                </div>
                <div class="stat-item">
                    <h3>上传中</h3>
                    <p>{{ stats.uploading }}</p>
                </div>
                <div class="stat-item">
                    <h3>已完成</h3>
                    <p>{{ stats.completed }}</p>
                </div>
                <div class="stat-item error">
                    <h3>失败任务</h3>
                    <div class="failed-stats">
                        <p>下载: {{ stats.failed.download }}</p>
                        <p>训练: {{ stats.failed.training }}</p>
                        <p>上传: {{ stats.failed.upload }}</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="action-buttons">
            <button 
                class="action-btn"
                :class="{ active: showConfig }"
                @click="toggleConfig"
            >
                <span class="icon">⚙️</span>
                <span class="text">系统配置</span>
            </button>
            <button class="action-btn" disabled>
                <span class="icon">📊</span>
                <span class="text">数据分析</span>
            </button>
            <button class="action-btn" disabled>
                <span class="icon">📝</span>
                <span class="text">日志查看</span>
            </button>
        </section>

        <section class="tasks">
            <div class="section-header">
                <h2>任务列表</h2>
                <div class="task-filters">
                    <input 
                        v-model="searchQuery" 
                        placeholder="搜索任务..." 
                        @input="filterTasks"
                    >
                    <div class="date-filters">
                        <input 
                            type="datetime-local" 
                            v-model="dateRange.start"
                            @change="filterTasks"
                            placeholder="开始时间"
                        >
                        <span>至</span>
                        <input 
                            type="datetime-local" 
                            v-model="dateRange.end"
                            @change="filterTasks"
                            placeholder="结束时间"
                        >
                    </div>
                    <select 
                        v-model="statusFilter" 
                        @change="filterTasks"
                    >
                        <option value="">全部状态</option>
                        <option 
                            v-for="status in statusOptions" 
                            :key="status"
                            :value="status"
                        >
                            {{ status }}
                        </option>
                    </select>
                </div>
            </div>
            <div class="task-list">
                <div 
                    v-for="task in filteredTasks" 
                    :key="task.folder_name" 
                    :class="['task-item', task.status.toLowerCase()]"
                >
                    <h3>{{ task.folder_name }}</h3>
                    <div class="task-info">
                        <p>
                            <strong>状态:</strong>
                            <span>{{ task.status }}</span>
                        </p>
                        <p>
                            <strong>创建时间:</strong>
                            <span>{{ formatDate(task.created_at) }}</span>
                        </p>
                        <p v-if="task.updated_at">
                            <strong>更新时间:</strong>
                            <span>{{ formatDate(task.updated_at) }}</span>
                        </p>
                        <p v-if="task.task_id">
                            <strong>任务ID:</strong>
                            <span>{{ task.task_id }}</span>
                        </p>
                        <p v-if="task.lora_path">
                            <strong>Lora路径:</strong>
                            <span>{{ task.lora_path }}</span>
                        </p>
                        <p v-if="task.error" class="error-message">
                            <strong>错误信息:</strong>
                            <span>{{ task.error }}</span>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <div class="modal-overlay" v-if="showConfig" @click="toggleConfig"></div>
        <div class="modal config-modal" v-if="showConfig">
            <div class="modal-header">
                <h2>系统配置</h2>
                <button class="close-btn" @click="toggleConfig">×</button>
            </div>
            <div class="modal-body">
                <form class="config-form" @submit.prevent="saveConfig">
                    <div class="form-group">
                        <label>源文件目录</label>
                        <input type="text" v-model="configForm.source_dir">
                    </div>
                    <div class="form-group">
                        <label>云盘目录</label>
                        <input type="text" v-model="configForm.mark_pan_dir">
                    </div>
                    <div class="form-group">
                        <label>Lora输出路径</label>
                        <input type="text" v-model="configForm.lora_output_path">
                    </div>
                    <div class="form-group">
                        <label>训练参数</label>
                        <div class="training-params">
                            <div class="param-group">
                                <label>学习率</label>
                                <input type="number" v-model="configForm.training.learning_rate" step="0.0001">
                            </div>
                            <div class="param-group">
                                <label>训练步数</label>
                                <input type="number" v-model="configForm.training.steps">
                            </div>
                            <div class="param-group">
                                <label>批次大小</label>
                                <input type="number" v-model="configForm.training.batch_size">
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button 
                            type="submit" 
                            class="save-btn"
                            :disabled="!configChanged"
                        >
                            保存更改
                        </button>
                    </div>
                </form>
                <div class="config-error" v-if="configError">
                    {{ configError }}
                </div>
            </div>
        </div>
    </div>
    <script src="/static/js/app.js"></script>
</body>
</html> 