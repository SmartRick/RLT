<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lora è®­ç»ƒä»»åŠ¡ç®¡ç†å™¨</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app">
        <header>
            <h1>Lora è®­ç»ƒä»»åŠ¡ç®¡ç†å™¨</h1>
            <p class="subtitle">å®æ—¶ç›‘æ§è®­ç»ƒä»»åŠ¡çŠ¶æ€</p>
        </header>

        <section class="stats">
            <h2>ä»»åŠ¡ç»Ÿè®¡</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>æ€»ä»»åŠ¡æ•°</h3>
                    <p>{{ stats.total }}</p>
                </div>
                <div class="stat-item">
                    <h3>ä¸‹è½½ä¸­</h3>
                    <p>{{ stats.downloading }}</p>
                </div>
                <div class="stat-item">
                    <h3>ç­‰å¾…è®­ç»ƒ</h3>
                    <p>{{ stats.pending }}</p>
                </div>
                <div class="stat-item">
                    <h3>è®­ç»ƒä¸­</h3>
                    <p>{{ stats.training }}</p>
                </div>
                <div class="stat-item">
                    <h3>ç­‰å¾…ä¸Šä¼ </h3>
                    <p>{{ stats.pending_upload }}</p>
                </div>
                <div class="stat-item">
                    <h3>ä¸Šä¼ ä¸­</h3>
                    <p>{{ stats.uploading }}</p>
                </div>
                <div class="stat-item">
                    <h3>å·²å®Œæˆ</h3>
                    <p>{{ stats.completed }}</p>
                </div>
                <div class="stat-item error">
                    <h3>å¤±è´¥ä»»åŠ¡</h3>
                    <div class="failed-stats">
                        <p>ä¸‹è½½: {{ stats.failed.download }}</p>
                        <p>è®­ç»ƒ: {{ stats.failed.training }}</p>
                        <p>ä¸Šä¼ : {{ stats.failed.upload }}</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="action-buttons">
            <button 
                class="action-btn"
                :class="{ active: showConfig }"
                @click="toggleConfig"
            >
                <span class="icon">âš™ï¸</span>
                <span class="text">ç³»ç»Ÿé…ç½®</span>
            </button>
            <button class="action-btn" disabled>
                <span class="icon">ğŸ“Š</span>
                <span class="text">æ•°æ®åˆ†æ</span>
            </button>
            <button class="action-btn" disabled>
                <span class="icon">ğŸ“</span>
                <span class="text">æ—¥å¿—æŸ¥çœ‹</span>
            </button>
        </section>

        <section class="tasks">
            <div class="section-header">
                <h2>ä»»åŠ¡åˆ—è¡¨</h2>
                <div class="task-filters">
                    <input 
                        v-model="searchQuery" 
                        placeholder="æœç´¢ä»»åŠ¡..." 
                        @input="filterTasks"
                    >
                    <div class="date-filters">
                        <input 
                            type="datetime-local" 
                            v-model="dateRange.start"
                            @change="filterTasks"
                            placeholder="å¼€å§‹æ—¶é—´"
                        >
                        <span>è‡³</span>
                        <input 
                            type="datetime-local" 
                            v-model="dateRange.end"
                            @change="filterTasks"
                            placeholder="ç»“æŸæ—¶é—´"
                        >
                    </div>
                    <select 
                        v-model="statusFilter" 
                        @change="filterTasks"
                    >
                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                        <option 
                            v-for="status in statusOptions" 
                            :key="status"
                            :value="status"
                        >
                            {{ status }}
                        </option>
                    </select>
                </div>
            </div>
            <div class="task-list">
                <div 
                    v-for="task in filteredTasks" 
                    :key="task.folder_name" 
                    :class="['task-item', task.status.toLowerCase()]"
                >
                    <h3>{{ task.folder_name }}</h3>
                    <div class="task-info">
                        <p>
                            <strong>çŠ¶æ€:</strong>
                            <span>{{ task.status }}</span>
                        </p>
                        <p>
                            <strong>åˆ›å»ºæ—¶é—´:</strong>
                            <span>{{ formatDate(task.created_at) }}</span>
                        </p>
                        <p v-if="task.updated_at">
                            <strong>æ›´æ–°æ—¶é—´:</strong>
                            <span>{{ formatDate(task.updated_at) }}</span>
                        </p>
                        <p v-if="task.task_id">
                            <strong>ä»»åŠ¡ID:</strong>
                            <span>{{ task.task_id }}</span>
                        </p>
                        <p v-if="task.lora_path">
                            <strong>Loraè·¯å¾„:</strong>
                            <span>{{ task.lora_path }}</span>
                        </p>
                        <p v-if="task.error" class="error-message">
                            <strong>é”™è¯¯ä¿¡æ¯:</strong>
                            <span>{{ task.error }}</span>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <div class="modal-overlay" v-if="showConfig" @click="toggleConfig"></div>
        <div class="modal config-modal" v-if="showConfig">
            <div class="modal-header">
                <h2>ç³»ç»Ÿé…ç½®</h2>
                <button class="close-btn" @click="toggleConfig">Ã—</button>
            </div>
            <div class="modal-body">
                <form class="config-form" @submit.prevent="saveConfig">
                    <div class="form-group">
                        <label>æºæ–‡ä»¶ç›®å½•</label>
                        <input type="text" v-model="configForm.source_dir">
                    </div>
                    <div class="form-group">
                        <label>äº‘ç›˜ç›®å½•</label>
                        <input type="text" v-model="configForm.mark_pan_dir">
                    </div>
                    <div class="form-group">
                        <label>Loraè¾“å‡ºè·¯å¾„</label>
                        <input type="text" v-model="configForm.lora_output_path">
                    </div>
                    <div class="form-group">
                        <label>è®­ç»ƒå‚æ•°</label>
                        <div class="training-params">
                            <div class="param-group">
                                <label>å­¦ä¹ ç‡</label>
                                <input type="number" v-model="configForm.training.learning_rate" step="0.0001">
                            </div>
                            <div class="param-group">
                                <label>è®­ç»ƒæ­¥æ•°</label>
                                <input type="number" v-model="configForm.training.steps">
                            </div>
                            <div class="param-group">
                                <label>æ‰¹æ¬¡å¤§å°</label>
                                <input type="number" v-model="configForm.training.batch_size">
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button 
                            type="submit" 
                            class="save-btn"
                            :disabled="!configChanged"
                        >
                            ä¿å­˜æ›´æ”¹
                        </button>
                    </div>
                </form>
                <div class="config-error" v-if="configError">
                    {{ configError }}
                </div>
            </div>
        </div>
    </div>
    <script src="/static/js/app.js"></script>
</body>
</html> 