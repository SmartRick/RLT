<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lora è®­ç»ƒä»»åŠ¡ç®¡ç†å™¨</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app">
        <header>
            <h1>Lora è®­ç»ƒä»»åŠ¡ç®¡ç†å™¨</h1>
            <p class="subtitle">å®æ—¶ç›‘æ§è®­ç»ƒä»»åŠ¡çŠ¶æ€</p>
        </header>

        <section class="stats">
            <h2>ä»»åŠ¡ç»Ÿè®¡</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>æ€»ä»»åŠ¡æ•°</h3>
                    <p>{{ stats.total }}</p>
                </div>
                <div class="stat-item">
                    <h3>ä¸‹è½½ä¸­</h3>
                    <p>{{ stats.downloading }}</p>
                </div>
                <div class="stat-item">
                    <h3>ç­‰å¾…è®­ç»ƒ</h3>
                    <p>{{ stats.pending }}</p>
                </div>
                <div class="stat-item">
                    <h3>è®­ç»ƒä¸­</h3>
                    <p>{{ stats.training }}</p>
                </div>
                <div class="stat-item">
                    <h3>ç­‰å¾…ä¸Šä¼ </h3>
                    <p>{{ stats.pending_upload }}</p>
                </div>
                <div class="stat-item">
                    <h3>ä¸Šä¼ ä¸­</h3>
                    <p>{{ stats.uploading }}</p>
                </div>
                <div class="stat-item">
                    <h3>å·²å®Œæˆ</h3>
                    <p>{{ stats.completed }}</p>
                </div>
                <div class="stat-item error">
                    <h3>å¤±è´¥ä»»åŠ¡</h3>
                    <div class="failed-stats">
                        <p>ä¸‹è½½: {{ stats.failed.download }}</p>
                        <p>è®­ç»ƒ: {{ stats.failed.training }}</p>
                        <p>ä¸Šä¼ : {{ stats.failed.upload }}</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="action-buttons">
            <button 
                class="action-btn"
                :class="{ active: showConfig }"
                @click="toggleConfig"
            >
                <span class="icon">âš™ï¸</span>
                <span class="text">ç³»ç»Ÿé…ç½®</span>
            </button>
            <button class="action-btn" disabled>
                <span class="icon">ğŸ“Š</span>
                <span class="text">æ•°æ®åˆ†æ</span>
            </button>
            <button 
                class="action-btn"
                :class="{ active: showLogs }"
                @click="toggleLogs"
            >
                <span class="icon">ğŸ“</span>
                <span class="text">æ—¥å¿—æŸ¥çœ‹</span>
            </button>
        </section>

        <section class="tasks">
            <div class="section-header">
                <h2>ä»»åŠ¡åˆ—è¡¨</h2>
                <div class="task-filters">
                    <input 
                        v-model="searchQuery" 
                        placeholder="æœç´¢ä»»åŠ¡..." 
                        @input="filterTasks"
                    >
                    <div class="date-filters">
                        <input 
                            type="datetime-local" 
                            v-model="dateRange.start"
                            @change="filterTasks"
                            placeholder="å¼€å§‹æ—¶é—´"
                        >
                        <span>è‡³</span>
                        <input 
                            type="datetime-local" 
                            v-model="dateRange.end"
                            @change="filterTasks"
                            placeholder="ç»“æŸæ—¶é—´"
                        >
                    </div>
                    <select 
                        v-model="statusFilter" 
                        @change="filterTasks"
                    >
                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                        <option 
                            v-for="status in statusOptions" 
                            :key="status"
                            :value="status"
                        >
                            {{ status }}
                        </option>
                    </select>
                </div>
            </div>
            <div class="task-list">
                <div 
                    v-for="task in filteredTasks" 
                    :key="task.folder_name" 
                    :class="['task-item', task.status.toLowerCase()]"
                >
                    <h3>{{ task.folder_name }}</h3>
                    <div class="task-info">
                        <p>
                            <strong>çŠ¶æ€:</strong>
                            <span>{{ task.status }}</span>
                        </p>
                        <p>
                            <strong>åˆ›å»ºæ—¶é—´:</strong>
                            <span>{{ formatDate(task.created_at) }}</span>
                        </p>
                        <p v-if="task.updated_at">
                            <strong>æ›´æ–°æ—¶é—´:</strong>
                            <span>{{ formatDate(task.updated_at) }}</span>
                        </p>
                        <p v-if="task.task_id">
                            <strong>ä»»åŠ¡ID:</strong>
                            <span>{{ task.task_id }}</span>
                        </p>
                        <p v-if="task.lora_path">
                            <strong>Loraè·¯å¾„:</strong>
                            <span>{{ task.lora_path }}</span>
                        </p>
                        <p v-if="task.error" class="error-message">
                            <strong>é”™è¯¯ä¿¡æ¯:</strong>
                            <span>{{ task.error }}</span>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <div class="modal-overlay" v-if="showConfig" @click="toggleConfig"></div>
        <div class="modal config-modal" v-if="showConfig">
            <div class="modal-header">
                <h2>ç³»ç»Ÿé…ç½®</h2>
                <button class="close-btn" @click="toggleConfig">Ã—</button>
            </div>
            <div class="modal-body">
                <form class="config-form" @submit.prevent="saveConfig">
                    <div class="form-group">
                        <label>æºæ–‡ä»¶ç›®å½•</label>
                        <input 
                            type="text" 
                            v-model="configForm.source_dir"
                            @input="onConfigChange"
                            placeholder="è®­ç»ƒæ•°æ®æºæ–‡ä»¶ç›®å½•"
                        >
                    </div>
                    <div class="form-group">
                        <label>Loraè¾“å‡ºè·¯å¾„</label>
                        <input 
                            type="text" 
                            v-model="configForm.lora_output_path"
                            @input="onConfigChange"
                            placeholder="è®­ç»ƒå®Œæˆçš„Loraæ¨¡å‹è¾“å‡ºè·¯å¾„"
                        >
                    </div>
                    <div class="form-group">
                        <label>å®šæ—¶æ£€æŸ¥é—´éš”ï¼ˆåˆ†é’Ÿï¼‰</label>
                        <input 
                            type="number" 
                            v-model="configForm.scheduling_minute"
                            @input="onConfigChange"
                            min="1"
                            step="1"
                        >
                    </div>
                    <div class="form-group">
                        <label>APIåœ°å€</label>
                        <input 
                            type="url" 
                            v-model="configForm.url"
                            @input="onConfigChange"
                            placeholder="http://127.0.0.1:28000"
                        >
                    </div>
                    <div class="form-group">
                        <label>äº‘ç›˜æ ‡è®°æ–‡ä»¶ç›®å½•</label>
                        <input 
                            type="text" 
                            v-model="configForm.mark_pan_dir"
                            @input="onConfigChange"
                            placeholder="/loraFile/mark"
                        >
                    </div>
                    <div class="form-group">
                        <label>äº‘ç›˜Loraä¸Šä¼ ç›®å½•</label>
                        <input 
                            type="text" 
                            v-model="configForm.lora_pan_upload_dir"
                            @input="onConfigChange"
                            placeholder="/loraFile/lora"
                        >
                    </div>
                    <div class="form-actions">
                        <button 
                            type="submit" 
                            class="save-btn"
                            :disabled="!configChanged"
                        >
                            ä¿å­˜æ›´æ”¹
                        </button>
                    </div>
                </form>
                <div class="config-error" v-if="configError">
                    {{ configError }}
                </div>
            </div>
        </div>

        <div class="modal-overlay" v-if="showLogs" @click="toggleLogs"></div>
        <div class="modal logs-modal" v-if="showLogs">
            <div class="modal-header">
                <h2>æ—¥å¿—æŸ¥çœ‹</h2>
                <button class="close-btn" @click="toggleLogs">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="logs-container">
                    <div class="log-files">
                        <div 
                            v-for="log in logFiles" 
                            :key="log.filename"
                            :class="['log-file', { active: currentLog === log.filename }]"
                            @click="selectLog(log.filename)"
                        >
                            <div class="log-file-name">{{ log.filename }}</div>
                            <div class="log-file-info">
                                <span>{{ formatDate(log.modified) }}</span>
                                <span>{{ formatFileSize(log.size) }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="log-content">
                        <div class="log-controls">
                            <select v-model="logLines" @change="loadLogContent">
                                <option value="100">æœ€è¿‘100è¡Œ</option>
                                <option value="500">æœ€è¿‘500è¡Œ</option>
                                <option value="1000">æœ€è¿‘1000è¡Œ</option>
                                <option value="5000">æœ€è¿‘5000è¡Œ</option>
                            </select>
                            <button 
                                class="refresh-btn"
                                @click="loadLogContent"
                                :disabled="!currentLog"
                            >
                                åˆ·æ–°
                            </button>
                            <button 
                                class="auto-refresh-btn"
                                :class="{ active: logAutoRefresh }"
                                @click="toggleAutoRefresh"
                                :disabled="!currentLog"
                            >
                                è‡ªåŠ¨åˆ·æ–°
                            </button>
                            <div class="scroll-controls">
                                <button 
                                    class="scroll-btn"
                                    @click="scrollToBottom"
                                    :disabled="!currentLog"
                                >
                                    æ»šåŠ¨åˆ°åº•éƒ¨
                                </button>
                            </div>
                        </div>
                        <div class="log-viewer" ref="logViewer">
                            <div v-if="!currentLog" class="no-log-selected">
                                è¯·é€‰æ‹©è¦æŸ¥çœ‹çš„æ—¥å¿—æ–‡ä»¶
                            </div>
                            <pre v-else>{{ logContent.join('') }}</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="/static/js/app.js"></script>
</body>
</html> 